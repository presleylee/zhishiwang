<include file="layout:head"/>
<div class="row">
    <ul class="crumb">
        <li><a href="/Home/">后台首页</a></li>
        <li><a href="/Question/index">问题管理</a></li>
        <li><a href="/Question/index">问题列表</a></li>
        <li class="last"><b><if condition="empty($question) eq false">修改<else />添加</if>问题</b></li>
    </ul>
</div>
    <div class="row" style="margin-top:20px;">
        <div class="col-sm-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <if condition="empty($question) eq false">修改<else />添加</if>问题
                </div>
                <div class="panel-body">
                    <div class="row">
                        <form role="form" method="post" action="/Question/editor">
                            <input type="hidden" name="id" value="{$question.id}" />
                            <div class="form-group row">
                                <label class="col-sm-2">问题分类</label>
                                <div class="col-sm-2">
                                    <select class="form-control" name="category1" id="category1">
                                        <option value="0">一级分类</option>
                                        <foreach name="category" item="m">
                                            <option value="{$m.id}" <eq name="question.category1" value="$m.id">selected</eq>>{$m.name}</option>
                                        </foreach>
                                    </select>
                                </div>
                                <div class="col-sm-2">
                                    <select class="form-control" name="category2" id="category2">
                                        <option value="0">二级分类</option>
                                        <foreach name="childcate" item="m">
                                            <option value="{$m.id}" <eq name="question.category2" value="$m.id">selected</eq>>{$m.name}</option>
                                        </foreach>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-2">问题标题</label>
                                <div class="col-sm-4"><input class="form-control" type="text" name="question" value="{$question.question}" /></div>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-2">问题选项</label>
                                <div class="col-sm-4">
                                    <button link="add" type="button" class="btn btn-success">增加答案</button>
                                    <button link="del" type="button" class="btn btn-default">删除答案</button>
                                    <ul class="answer">
                                        <if condition="empty($answer) eq false">
                                            <php>$i = 1;</php>
                                            <foreach name="answer" item="item">
                                                <li>答案{$i}：<input class="form-control" type="text" name="answer[]" value="{$item.answer}" /> <label><input type="radio" value="{$i}" name="answer_right[]" <eq name="item.is_right" value="1">selected</eq> />正确答案</label></li>
                                                <php>$i++;</php>
                                            </foreach>
                                            <else />
                                        <li>答案1：<input class="form-control" type="text" name="answer[]" /> <label><input value="1" type="radio" name="is_right" />正确答案</label></li>
                                        <li>答案2：<input class="form-control" type="text" name="answer[]" /> <label><input value="2" type="radio" name="is_right" />正确答案</label></li>
                                        <li>答案3：<input class="form-control" type="text" name="answer[]" /> <label><input value="3" type="radio" name="is_right" />正确答案</label></li>
                                        <li>答案4：<input class="form-control" type="text" name="answer[]" /> <label><input value="4" type="radio" name="is_right" />正确答案</label></li>
                                        </if>
                                    </ul>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-2">是否显示</label>
                                <div class="col-sm-4">
                                    <label>
                                        <input type="radio" name="status" id="status1" value="1" checked="" />是
                                    </label>
                                    <label>
                                        <input type="radio" name="status" id="status2" value="0" />否
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-2"></div>
                                <div class="">
                                    <button type="submit" class="btn btn-success">保 存</button>
                                    <button type="reset" class="btn btn-default">重 设</button>
                                </div>
                            </div>
                        </form>
                    </div>
                    <!-- /.row (nested) -->
                </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->
        </div>
        <!-- /.col-sm-8 -->
    </div>
    <!-- /.row -->
<include file="layout:foot"/>
<script>
    $('[link="add"]').off().on('click', function(){
        if ($('[name="answer[]"]').length >= 10) {
            alert('最多只可添加十个答案');
            return ;
        }
        var idx = $('[name="answer[]"]').length + 1;
        $(this).next().next().append('<li>答案'+ idx +'：<input class="form-control" type="text" name="answer[]" /> <label><input value="'+ idx +'" type="radio" name="is_right" />正确答案</label></li>');
    })

    $('[link="del"]').off().on('click', function(){
        if ($('[name="answer[]"]').length <= 2) {
            alert('答案个数不能少于两个');
            return ;
        }
        $('[name="answer[]"]:last').parent().remove();
    })

    $('#category1').on('change', function(){
        var id = $(this).val();
        $('#category2').html('<option value="0">二级分类</option>');
        if (id) {
            $.ajax({
                type: 'get',
                url: '/Question/getCate/',
                data: {pid: id},
                dataType: 'json',
                success: function (result) {
                    var html = '';
                    for (var i in result) {
                        html += '<option value="' + result[i]['id'] + '">' + result[i]['name'] + '</option>'
                    }
                    $('#category2').append(html);
                }
            });
        }
    })

    </script>
</body>
</html>
